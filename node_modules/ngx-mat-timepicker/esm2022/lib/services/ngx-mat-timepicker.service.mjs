import { Injectable } from "@angular/core";
import { NgxMatTimepickerPeriods } from "../models/ngx-mat-timepicker-periods.enum";
import { NgxMatTimepickerAdapter } from "./ngx-mat-timepicker-adapter";
//
import { BehaviorSubject } from "rxjs";
import * as i0 from "@angular/core";
const DEFAULT_HOUR = {
    time: 12,
    angle: 360
};
const DEFAULT_MINUTE = {
    time: 0,
    angle: 360
};
export class NgxMatTimepickerService {
    constructor() {
        this._hour$ = new BehaviorSubject(DEFAULT_HOUR);
        this._minute$ = new BehaviorSubject(DEFAULT_MINUTE);
        this._period$ = new BehaviorSubject(NgxMatTimepickerPeriods.AM);
    }
    set hour(hour) {
        this._hour$.next(hour);
    }
    set minute(minute) {
        this._minute$.next(minute);
    }
    set period(period) {
        const isPeriodValid = (period === NgxMatTimepickerPeriods.AM) || (period === NgxMatTimepickerPeriods.PM);
        if (isPeriodValid) {
            this._period$.next(period);
        }
    }
    get selectedHour() {
        return this._hour$.asObservable();
    }
    get selectedMinute() {
        return this._minute$.asObservable();
    }
    get selectedPeriod() {
        return this._period$.asObservable();
    }
    getFullTime(format) {
        const selectedHour = this._hour$.getValue().time;
        const selectedMinute = this._minute$.getValue().time;
        const hour = selectedHour != null ? selectedHour : DEFAULT_HOUR.time;
        const minute = selectedMinute != null ? selectedMinute : DEFAULT_MINUTE.time;
        const period = format === 12 ? this._period$.getValue() : "";
        const time = `${hour}:${minute} ${period}`.trim();
        return NgxMatTimepickerAdapter.formatTime(time, { format });
    }
    setDefaultTimeIfAvailable(time, min, max, format, minutesGap) {
        time || this._resetTime();
        /* Workaround to double error message*/
        try {
            if (NgxMatTimepickerAdapter.isTimeAvailable(time, min, max, "minutes", minutesGap)) {
                this._setDefaultTime(time, format);
            }
        }
        catch (e) {
            console.error(e);
        }
    }
    _resetTime() {
        this.hour = { ...DEFAULT_HOUR };
        this.minute = { ...DEFAULT_MINUTE };
        this.period = NgxMatTimepickerPeriods.AM;
    }
    _setDefaultTime(time, format) {
        const defaultDto = NgxMatTimepickerAdapter.parseTime(time, { format });
        if (defaultDto.isValid) {
            const period = time.substring(time.length - 2).toUpperCase();
            const hour = defaultDto.hour;
            this.hour = { ...DEFAULT_HOUR, time: formatHourByPeriod(hour, period) };
            this.minute = { ...DEFAULT_MINUTE, time: defaultDto.minute };
            this.period = period;
        }
        else {
            this._resetTime();
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.0.5", ngImport: i0, type: NgxMatTimepickerService, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "18.0.5", ngImport: i0, type: NgxMatTimepickerService, providedIn: "root" }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.0.5", ngImport: i0, type: NgxMatTimepickerService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: "root"
                }]
        }] });
/***
 *  Format hour in 24hours format to meridian (AM or PM) format
 */
function formatHourByPeriod(hour, period) {
    switch (period) {
        case NgxMatTimepickerPeriods.AM:
            return hour === 0 ? 12 : hour;
        case NgxMatTimepickerPeriods.PM:
            return hour === 12 ? 12 : hour - 12;
        default:
            return hour;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LW1hdC10aW1lcGlja2VyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtbWF0LXRpbWVwaWNrZXIvc3JjL2xpYi9zZXJ2aWNlcy9uZ3gtbWF0LXRpbWVwaWNrZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBR3pDLE9BQU8sRUFBQyx1QkFBdUIsRUFBQyxNQUFNLDJDQUEyQyxDQUFDO0FBQ2xGLE9BQU8sRUFBQyx1QkFBdUIsRUFBQyxNQUFNLDhCQUE4QixDQUFDO0FBQ3JFLEVBQUU7QUFDRixPQUFPLEVBQUMsZUFBZSxFQUFhLE1BQU0sTUFBTSxDQUFDOztBQUdqRCxNQUFNLFlBQVksR0FBOEI7SUFDNUMsSUFBSSxFQUFFLEVBQUU7SUFDUixLQUFLLEVBQUUsR0FBRztDQUNiLENBQUM7QUFDRixNQUFNLGNBQWMsR0FBOEI7SUFDOUMsSUFBSSxFQUFFLENBQUM7SUFDUCxLQUFLLEVBQUUsR0FBRztDQUNiLENBQUM7QUFLRixNQUFNLE9BQU8sdUJBQXVCO0lBSHBDO1FBa0NZLFdBQU0sR0FBRyxJQUFJLGVBQWUsQ0FBNEIsWUFBWSxDQUFDLENBQUM7UUFDdEUsYUFBUSxHQUFHLElBQUksZUFBZSxDQUE0QixjQUFjLENBQUMsQ0FBQztRQUMxRSxhQUFRLEdBQUcsSUFBSSxlQUFlLENBQTBCLHVCQUF1QixDQUFDLEVBQUUsQ0FBQyxDQUFDO0tBaUQvRjtJQS9FRyxJQUFJLElBQUksQ0FBQyxJQUErQjtRQUNwQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMzQixDQUFDO0lBRUQsSUFBSSxNQUFNLENBQUMsTUFBaUM7UUFDeEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVELElBQUksTUFBTSxDQUFDLE1BQStCO1FBQ3RDLE1BQU0sYUFBYSxHQUFHLENBQUMsTUFBTSxLQUFLLHVCQUF1QixDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLHVCQUF1QixDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRXpHLElBQUksYUFBYSxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDL0IsQ0FBQztJQUNMLENBQUM7SUFFRCxJQUFJLFlBQVk7UUFDWixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDdEMsQ0FBQztJQUVELElBQUksY0FBYztRQUNkLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN4QyxDQUFDO0lBRUQsSUFBSSxjQUFjO1FBQ2QsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3hDLENBQUM7SUFNRCxXQUFXLENBQUMsTUFBYztRQUN0QixNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxDQUFDLElBQUksQ0FBQztRQUNqRCxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDLElBQUksQ0FBQztRQUNyRCxNQUFNLElBQUksR0FBRyxZQUFZLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUM7UUFDckUsTUFBTSxNQUFNLEdBQUcsY0FBYyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDO1FBQzdFLE1BQU0sTUFBTSxHQUFHLE1BQU0sS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUM3RCxNQUFNLElBQUksR0FBRyxHQUFHLElBQUksSUFBSSxNQUFNLElBQUksTUFBTSxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFbEQsT0FBTyx1QkFBdUIsQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLEVBQUMsTUFBTSxFQUFDLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBR0QseUJBQXlCLENBQUMsSUFBWSxFQUFFLEdBQWEsRUFBRSxHQUFhLEVBQUUsTUFBYyxFQUFFLFVBQW1CO1FBQ3JHLElBQUksSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDMUIsdUNBQXVDO1FBQ3ZDLElBQUksQ0FBQztZQUNELElBQUksdUJBQXVCLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxVQUFVLENBQUMsRUFBRSxDQUFDO2dCQUNqRixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztZQUN2QyxDQUFDO1FBQ0wsQ0FBQztRQUNELE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDUCxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3JCLENBQUM7SUFDTCxDQUFDO0lBRU8sVUFBVTtRQUNkLElBQUksQ0FBQyxJQUFJLEdBQUcsRUFBQyxHQUFHLFlBQVksRUFBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBQyxHQUFHLGNBQWMsRUFBQyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxNQUFNLEdBQUcsdUJBQXVCLENBQUMsRUFBRSxDQUFDO0lBQzdDLENBQUM7SUFFTyxlQUFlLENBQUMsSUFBWSxFQUFFLE1BQWM7UUFDaEQsTUFBTSxVQUFVLEdBQUcsdUJBQXVCLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxFQUFDLE1BQU0sRUFBQyxDQUFDLENBQUM7UUFFckUsSUFBSSxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDckIsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzdELE1BQU0sSUFBSSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUM7WUFFN0IsSUFBSSxDQUFDLElBQUksR0FBRyxFQUFDLEdBQUcsWUFBWSxFQUFFLElBQUksRUFBRSxrQkFBa0IsQ0FBQyxJQUFJLEVBQUUsTUFBaUMsQ0FBQyxFQUFDLENBQUM7WUFDakcsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFDLEdBQUcsY0FBYyxFQUFFLElBQUksRUFBRSxVQUFVLENBQUMsTUFBTSxFQUFDLENBQUM7WUFDM0QsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFpQyxDQUFDO1FBRXBELENBQUM7YUFDSSxDQUFDO1lBQ0YsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3RCLENBQUM7SUFDTCxDQUFDOzhHQWpGUSx1QkFBdUI7a0hBQXZCLHVCQUF1QixjQUZwQixNQUFNOzsyRkFFVCx1QkFBdUI7a0JBSG5DLFVBQVU7bUJBQUM7b0JBQ1IsVUFBVSxFQUFFLE1BQU07aUJBQ3JCOztBQXFGRDs7R0FFRztBQUNILFNBQVMsa0JBQWtCLENBQUMsSUFBWSxFQUFFLE1BQStCO0lBQ3JFLFFBQVEsTUFBTSxFQUFFLENBQUM7UUFDYixLQUFLLHVCQUF1QixDQUFDLEVBQUU7WUFDM0IsT0FBTyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNsQyxLQUFLLHVCQUF1QixDQUFDLEVBQUU7WUFDM0IsT0FBTyxJQUFJLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7UUFDeEM7WUFDSSxPQUFPLElBQUksQ0FBQztJQUNwQixDQUFDO0FBQ0wsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SW5qZWN0YWJsZX0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuLy9cclxuaW1wb3J0IHtOZ3hNYXRUaW1lcGlja2VyQ2xvY2tGYWNlfSBmcm9tIFwiLi4vbW9kZWxzL25neC1tYXQtdGltZXBpY2tlci1jbG9jay1mYWNlLmludGVyZmFjZVwiO1xyXG5pbXBvcnQge05neE1hdFRpbWVwaWNrZXJQZXJpb2RzfSBmcm9tIFwiLi4vbW9kZWxzL25neC1tYXQtdGltZXBpY2tlci1wZXJpb2RzLmVudW1cIjtcclxuaW1wb3J0IHtOZ3hNYXRUaW1lcGlja2VyQWRhcHRlcn0gZnJvbSBcIi4vbmd4LW1hdC10aW1lcGlja2VyLWFkYXB0ZXJcIjtcclxuLy9cclxuaW1wb3J0IHtCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGV9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7RGF0ZVRpbWV9IGZyb20gXCJ0cy1sdXhvblwiO1xyXG5cclxuY29uc3QgREVGQVVMVF9IT1VSOiBOZ3hNYXRUaW1lcGlja2VyQ2xvY2tGYWNlID0ge1xyXG4gICAgdGltZTogMTIsXHJcbiAgICBhbmdsZTogMzYwXHJcbn07XHJcbmNvbnN0IERFRkFVTFRfTUlOVVRFOiBOZ3hNYXRUaW1lcGlja2VyQ2xvY2tGYWNlID0ge1xyXG4gICAgdGltZTogMCxcclxuICAgIGFuZ2xlOiAzNjBcclxufTtcclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICAgIHByb3ZpZGVkSW46IFwicm9vdFwiXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBOZ3hNYXRUaW1lcGlja2VyU2VydmljZSB7XHJcblxyXG5cclxuICAgIHNldCBob3VyKGhvdXI6IE5neE1hdFRpbWVwaWNrZXJDbG9ja0ZhY2UpIHtcclxuICAgICAgICB0aGlzLl9ob3VyJC5uZXh0KGhvdXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBtaW51dGUobWludXRlOiBOZ3hNYXRUaW1lcGlja2VyQ2xvY2tGYWNlKSB7XHJcbiAgICAgICAgdGhpcy5fbWludXRlJC5uZXh0KG1pbnV0ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHBlcmlvZChwZXJpb2Q6IE5neE1hdFRpbWVwaWNrZXJQZXJpb2RzKSB7XHJcbiAgICAgICAgY29uc3QgaXNQZXJpb2RWYWxpZCA9IChwZXJpb2QgPT09IE5neE1hdFRpbWVwaWNrZXJQZXJpb2RzLkFNKSB8fCAocGVyaW9kID09PSBOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcy5QTSk7XHJcblxyXG4gICAgICAgIGlmIChpc1BlcmlvZFZhbGlkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3BlcmlvZCQubmV4dChwZXJpb2QpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgc2VsZWN0ZWRIb3VyKCk6IE9ic2VydmFibGU8Tmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9ob3VyJC5hc09ic2VydmFibGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgc2VsZWN0ZWRNaW51dGUoKTogT2JzZXJ2YWJsZTxOZ3hNYXRUaW1lcGlja2VyQ2xvY2tGYWNlPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX21pbnV0ZSQuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHNlbGVjdGVkUGVyaW9kKCk6IE9ic2VydmFibGU8Tmd4TWF0VGltZXBpY2tlclBlcmlvZHM+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcGVyaW9kJC5hc09ic2VydmFibGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9ob3VyJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Tmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZT4oREVGQVVMVF9IT1VSKTtcclxuICAgIHByaXZhdGUgX21pbnV0ZSQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PE5neE1hdFRpbWVwaWNrZXJDbG9ja0ZhY2U+KERFRkFVTFRfTUlOVVRFKTtcclxuICAgIHByaXZhdGUgX3BlcmlvZCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PE5neE1hdFRpbWVwaWNrZXJQZXJpb2RzPihOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcy5BTSk7XHJcblxyXG4gICAgZ2V0RnVsbFRpbWUoZm9ybWF0OiBudW1iZXIpOiBzdHJpbmcge1xyXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkSG91ciA9IHRoaXMuX2hvdXIkLmdldFZhbHVlKCkudGltZTtcclxuICAgICAgICBjb25zdCBzZWxlY3RlZE1pbnV0ZSA9IHRoaXMuX21pbnV0ZSQuZ2V0VmFsdWUoKS50aW1lO1xyXG4gICAgICAgIGNvbnN0IGhvdXIgPSBzZWxlY3RlZEhvdXIgIT0gbnVsbCA/IHNlbGVjdGVkSG91ciA6IERFRkFVTFRfSE9VUi50aW1lO1xyXG4gICAgICAgIGNvbnN0IG1pbnV0ZSA9IHNlbGVjdGVkTWludXRlICE9IG51bGwgPyBzZWxlY3RlZE1pbnV0ZSA6IERFRkFVTFRfTUlOVVRFLnRpbWU7XHJcbiAgICAgICAgY29uc3QgcGVyaW9kID0gZm9ybWF0ID09PSAxMiA/IHRoaXMuX3BlcmlvZCQuZ2V0VmFsdWUoKSA6IFwiXCI7XHJcbiAgICAgICAgY29uc3QgdGltZSA9IGAke2hvdXJ9OiR7bWludXRlfSAke3BlcmlvZH1gLnRyaW0oKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLmZvcm1hdFRpbWUodGltZSwge2Zvcm1hdH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBzZXREZWZhdWx0VGltZUlmQXZhaWxhYmxlKHRpbWU6IHN0cmluZywgbWluOiBEYXRlVGltZSwgbWF4OiBEYXRlVGltZSwgZm9ybWF0OiBudW1iZXIsIG1pbnV0ZXNHYXA/OiBudW1iZXIpIHtcclxuICAgICAgICB0aW1lIHx8IHRoaXMuX3Jlc2V0VGltZSgpO1xyXG4gICAgICAgIC8qIFdvcmthcm91bmQgdG8gZG91YmxlIGVycm9yIG1lc3NhZ2UqL1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChOZ3hNYXRUaW1lcGlja2VyQWRhcHRlci5pc1RpbWVBdmFpbGFibGUodGltZSwgbWluLCBtYXgsIFwibWludXRlc1wiLCBtaW51dGVzR2FwKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2V0RGVmYXVsdFRpbWUodGltZSwgZm9ybWF0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9yZXNldFRpbWUoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5ob3VyID0gey4uLkRFRkFVTFRfSE9VUn07XHJcbiAgICAgICAgdGhpcy5taW51dGUgPSB7Li4uREVGQVVMVF9NSU5VVEV9O1xyXG4gICAgICAgIHRoaXMucGVyaW9kID0gTmd4TWF0VGltZXBpY2tlclBlcmlvZHMuQU07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfc2V0RGVmYXVsdFRpbWUodGltZTogc3RyaW5nLCBmb3JtYXQ6IG51bWJlcikge1xyXG4gICAgICAgIGNvbnN0IGRlZmF1bHREdG8gPSBOZ3hNYXRUaW1lcGlja2VyQWRhcHRlci5wYXJzZVRpbWUodGltZSwge2Zvcm1hdH0pO1xyXG5cclxuICAgICAgICBpZiAoZGVmYXVsdER0by5pc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBlcmlvZCA9IHRpbWUuc3Vic3RyaW5nKHRpbWUubGVuZ3RoIC0gMikudG9VcHBlckNhc2UoKTtcclxuICAgICAgICAgICAgY29uc3QgaG91ciA9IGRlZmF1bHREdG8uaG91cjtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaG91ciA9IHsuLi5ERUZBVUxUX0hPVVIsIHRpbWU6IGZvcm1hdEhvdXJCeVBlcmlvZChob3VyLCBwZXJpb2QgYXMgTmd4TWF0VGltZXBpY2tlclBlcmlvZHMpfTtcclxuICAgICAgICAgICAgdGhpcy5taW51dGUgPSB7Li4uREVGQVVMVF9NSU5VVEUsIHRpbWU6IGRlZmF1bHREdG8ubWludXRlfTtcclxuICAgICAgICAgICAgdGhpcy5wZXJpb2QgPSBwZXJpb2QgYXMgTmd4TWF0VGltZXBpY2tlclBlcmlvZHM7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fcmVzZXRUaW1lKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG4vKioqXHJcbiAqICBGb3JtYXQgaG91ciBpbiAyNGhvdXJzIGZvcm1hdCB0byBtZXJpZGlhbiAoQU0gb3IgUE0pIGZvcm1hdFxyXG4gKi9cclxuZnVuY3Rpb24gZm9ybWF0SG91ckJ5UGVyaW9kKGhvdXI6IG51bWJlciwgcGVyaW9kOiBOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcyk6IG51bWJlciB7XHJcbiAgICBzd2l0Y2ggKHBlcmlvZCkge1xyXG4gICAgICAgIGNhc2UgTmd4TWF0VGltZXBpY2tlclBlcmlvZHMuQU06XHJcbiAgICAgICAgICAgIHJldHVybiBob3VyID09PSAwID8gMTIgOiBob3VyO1xyXG4gICAgICAgIGNhc2UgTmd4TWF0VGltZXBpY2tlclBlcmlvZHMuUE06XHJcbiAgICAgICAgICAgIHJldHVybiBob3VyID09PSAxMiA/IDEyIDogaG91ciAtIDEyO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHJldHVybiBob3VyO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==